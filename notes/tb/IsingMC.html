<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Structure Optimization with VASP – Haitao Hu</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Notes on structure optimization using VASP" />

    <!-- highlight.js 样式（主题可以换，这里用 github 风格） -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">

    <!-- highlight.js 主脚本 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <!-- 语言包：matlab（如果还要别的语言就再多引入几个） -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/matlab.min.js"></script>

    <!-- MathJax 配置 + 引入 -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>

    <!-- 你可以直接把主页 index.html 里的 <style> 整段复制过来，
       这里我只放最核心的一些，保证能看 -->
    <style>
        /* ===== 基本样式 ===== */
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            line-height: 1.6;
            color: #222;
            background-color: #f5f5f5;
        }

        a {
            color: #0077cc;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        /* ===== 顶部导航栏 ===== */
        header {
            background: #111827;
            color: #f9fafb;
            padding: 16px 24px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .nav-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 8px;
        }

        .site-title {
            font-size: 20px;
            font-weight: 600;
        }

        nav a {
            margin-left: 16px;
            font-size: 14px;
        }

        /* ===== 主体内容 ===== */
        main {
            max-width: 900px;
            margin: 24px auto 40px auto;
            padding: 0 16px;
        }

        section {
            background: #ffffff;
            border-radius: 8px;
            padding: 20px 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
        }

        h1,
        h2 {
            margin-top: 0;
        }

        h1 {
            font-size: 28px;
            margin-bottom: 4px;
        }

        .subtitle {
            color: #4b5563;
            font-size: 15px;
        }

        h2 {
            font-size: 20px;
            margin-bottom: 8px;
            border-left: 4px solid #2563eb;
            padding-left: 8px;
        }

        ul {
            padding-left: 20px;
            margin-top: 4px;
        }

        .tag-list span {
            display: inline-block;
            background: #e5e7eb;
            border-radius: 999px;
            padding: 2px 10px;
            font-size: 12px;
            margin: 2px 4px 2px 0;
        }

        .two-column {
            display: flex;
            flex-wrap: wrap;
            gap: 24px;
        }

        .col {
            flex: 1 1 260px;
        }

        .contact-list div {
            margin-bottom: 4px;
        }

        footer {
            text-align: center;
            color: #6b7280;
            font-size: 12px;
            margin-bottom: 20px;
        }

        @media (max-width: 600px) {
            header {
                padding: 12px 16px;
            }

            .site-title {
                font-size: 18px;
            }

            main {
                margin-top: 16px;
            }
        }
    </style>
</head>

<body>
    <!-- 顶部导航 -->
    <header>
        <div class="nav-container">
            <div class="site-title">Haitao Hu</div>
            <div class="breadcrumbs">
                <a href="/index.html">Home</a> ·
                <a href="/notes/tb/index.html">notes on Tight-binding models</a> ·
                <span>Ising 模型的 Monte Carlo 模拟</span>
            </div>
        </div>
    </header>

    <main>
        <article class="note-card">
            <h1>Ising 模型的 Monte Carlo 模拟</h1>
            <div class="note-meta">
                Last updated:
                <time id="last-updated"></time>
            </div>

            <!-- 自动生成目录 -->
            <div class="toc">
                <div class="toc-title">Contents</div>
                <ul id="toc-list"></ul>
            </div>

            <!-- 正文部分，可随意替换 -->
            <h2 id="basic-idea">1. Ising 模型</h2>
            <p>
                Ising模型，是物理学家 Lenz 和 Ising (Lenz的学生) 在 1920
                年左右提出的用来模拟磁性的格点模型。其考虑的是离散网格模型，在每一个格点处有一个自旋，取值只能取1或-1，分别代表自旋向上和向下。考虑最近邻相互作用，相互作用强度为$J_{ij}$。此外，每个自旋还受到外部磁场的影响，其强度为$h_i$。体系总哈密顿量为
                \begin{align}
                H(\sigma) = -\sum_{\braket{i,j}} J_{ij} \sigma_i \sigma_j - \mu \sum_j h_j \sigma_j. \label{eq1}
                \end{align}
                其中 $\braket{i,j}$ 代表最近邻，$\mu$ 代表磁矩，$\sigma_i$ 只能取 $\pm 1$。温度 $T$
                下，系统不是永远待在能量最低的构型上，而是在热涨落下在各种构型之间切换。根据统计物理，正则系综在热平衡时构型 $\sigma$ 出现的概率为
                \begin{align}
                P_{\beta}(\sigma) = e^{- \beta H(\sigma)} / Z_{\beta}. \label{eq2}
                \end{align}
                其中 $\beta = (k_B T)^{-1}$，归一化常量/配分函数为
                \begin{align}
                Z_{\beta} = \sum_{\sigma} e^{- \beta H(\sigma)}. \label{eq3}
                \end{align}
                对于函数 $f$，其平均值为
                \begin{align}
                \braket{f}_{\beta} = \sum_{\sigma} f(\sigma) P_{\beta}(\sigma).
                \end{align}
                当$J_{ij}$大于0时，称为铁磁，反之为反铁磁。而对于正的$h_j$，格点$j$上的自旋趋于朝向正，反之向负。


            <h2 id="basic-idea">2. 蒙卡模拟</h2>
            <p>
                蒙卡的核心思想是重要抽样，这是因为随机抽样得到的很多样本本质是在做无用功，而在高维问题中，要遍历所有可能的状态又是不现实的。实现这一思想的方法是Metropolis算法，其基本流程如下
            <ol>
                <li>选定一个初态，计算能量</li>
                <li>随机翻转某一个自旋，并计算翻转后的能量</li>
                <li>如果能量降低则保持翻转，如果能量升高则按$e^{- \beta (H' - H)}$概率保持翻转</li>
                <li>重复以上步骤，可以通过收敛判断，也可以通过设置一个迭代步数</li>
            </ol>
            <h2 id="basic-idea">3. 代码</h2>
            <p>
                以下是一个简单的 Matlab 代码实现二维 Ising 模型的 Monte Carlo 模拟，计算不同温度下的磁化强度。
            <pre><code class="language-matlab">
clear; clc; close all
N = 10;
J = 1;
nsteps = 80000;
T_sec = 0.1:0.1:5;

ts = zeros(size(T_sec));  
aa = 1;
for T = T_sec
    %initial spin
    spins = 2 * (rand(N,N) > 0.5) - 1;

    %metropolis
    for n = 1:1:nsteps
        %choose a spin in random
        i = randi([1,N],1,1);
        j = randi([1,N],1,1);

        %the difference of energy
        dE= 2 * J * spins(i,j) * (spins(mod(i,N)+1,j) + spins(mod(i-2,N)+1,j) + spins(i,mod(j,N)+1) + spins(i,mod(j-2,N)+1));

        %metropolis rule
        if dE < 0
            spins(i,j) = -spins(i,j);
        elseif rand() < exp(-dE/T)
            spins(i,j) = -spins(i,j);
        end
    end

    % total spin
    ts(aa) = abs(sum(sum(spins))/N/N);
    aa = aa+1;
end

% plot
plot(T_sec, ts, 'o-', 'linewidth', 1.5, 'color', 'k')
xlabel('Temperature','FontSize',15);
ylabel('Magnetization','FontSize',15)
</code></pre>

            <p>
                结果大致如图所示：可以看到在临界温度附近（约 $T \approx 2.5$），体系的磁化强度出现快速下降。
            </p>

            <img src="Ising.png" alt="Ising MC Result"
                style="display:block; margin:10px auto 0; max-width:600px; width:100%; height:auto;" />
 
            <h2 id="basic-idea">题外话：配分函数和自由能</h2>
            <p>
                有了配分函数就可以求出自由能 $F$
                \begin{align}
                F = - k_B T \ln Z_{\beta}. \label{eq4}
                \end{align}

                这可以从定义式出发得到
                \begin{align}
                F \equiv U-TS
                \end{align}
                其中 $U$ 是平均能量，$S$ 是熵。

                首先有波尔兹曼分布
                \begin{align}
                p_s=\frac{e^{-\beta E_s}}{Z}.
                \end{align}
                两边取对数
                \begin{align}
                \ln p_s = -\beta E_s - \ln Z.
                \end{align}
                把它乘上 $-k_B p_s$ 并对所有状态求和
                \begin{align}
                -k_B \sum_s p_s \ln p_s
                = -k_B\sum_s p_s(-\beta E_s-\ln Z)
                = k_B\beta\sum_s p_s E_s + k_B(\ln Z)\sum_s p_s.
                \end{align}
                注意到 $\sum_s p_s E_s = U$（平均能量），$\sum_s p_s = 1$，而左边 $-k_B \sum_s p_s \ln p_s$ 正是统计物理里熵的定义。所以有
                \begin{align}
                S = k_B\beta U + k_B\ln Z.
                \end{align}
                把它代入自由能定义 $F=U-TS$，并用 $\beta=1/(k_BT)$
                \begin{align}
                F = U - T (k_B\beta U + k_B \ln Z)
                = U - T (\frac{U}{T}+k_B\ln Z )
                = -k_BT \ln Z.
                \end{align}

            

            </p>
        </article>
    </main>

    <footer>
        © <span id="year"></span> Haitao Hu
    </footer>

    <script>
        // 自动更新年份
        const yearElem = document.getElementById('year');
        if (yearElem) {
            yearElem.textContent = new Date().getFullYear();
        }

        // 自动更新最后修改时间
        const lastUpdatedElem = document.getElementById("last-updated");
        if (lastUpdatedElem) {
            const t = new Date(document.lastModified);
            const pad = n => String(n).padStart(2, "0");
            const formatted = `${t.getFullYear()}-${pad(t.getMonth() + 1)}-${pad(t.getDate())}`;
            lastUpdatedElem.textContent = formatted;
        }

        // 自动生成目录
        const tocList = document.getElementById("toc-list");
        if (tocList) {
            const headings = document.querySelectorAll("h2");

            headings.forEach((h, i) => {
                // 没写 id 的话自动补一个
                if (!h.id) {
                    h.id = "section-" + (i + 1);
                }

                const li = document.createElement("li");
                const a = document.createElement("a");
                a.href = "#" + h.id;
                a.textContent = h.textContent;
                li.appendChild(a);
                tocList.appendChild(li);
            });
        }
        // 自动高亮所有 <pre><code>...</code></pre>
        hljs.highlightAll();
    </script>

</body>

</html>